import os, sys
os.chdir("../")
sys.setrecursionlimit(100000) 
sys.path.append(os.path.abspath(""))
os.chdir("./pSCRDRtagger")

#Change or add other thresholds: thresholds = [(5,5),(3, 2),(2,2)]
thresholds = [(3, 2)]

def Training(args = sys.argv[2:]):
    """
    Training RDRPOSTagger using initialized corpus against golden corpus!
    The initialized corpus is already generated by the use of an external initial tagger.
    """
    
    from SCRDRlearner.PosTaggingRDRTree import PosTaggingRDRTree
    
    dirPath = os.path.join(args[0] + "/")
    correctTrain = args[1]
    initializedTrain = args[2]
    learntRules = args[3]
    
    print '\nTraining RDRPOSTagger in the use of initialized corpus against golden corpus....'
    print 'Building SCRDR-based POS tagging tree of rules...'
    
    for (improveThreshold, matchThreshold) in thresholds:
        outputDir = "T%d-%d/" % (improveThreshold, matchThreshold)     
        os.mkdir(dirPath + outputDir)         
        
        rdrTree = PosTaggingRDRTree(improveThreshold, matchThreshold) 
        rdrTree.buildTreeFromCorpus(dirPath + initializedTrain, dirPath + correctTrain)
        
        print "Write the tree to file..."
        rdrTree.writeToFileWithoutSeenCases(dirPath + outputDir + learntRules)
        #rdrTree.writeToFile(dirPath + outputDir + learntRules)
        
    print 'Completed!'

def TaggingInitializedCorpus(args = sys.argv[2:]):

    learntRulesPath = args[0]
    initTestCorpusPath = args[1]
 
    print "\nTagging initialized corpus:", initTestCorpusPath
    from SCRDRlearner.PosTaggingRDRTree import PosTaggingRDRTree
    r = PosTaggingRDRTree()
    r.constructTreeFromRulesFile(learntRulesPath)
    r.tagInitializedCorpus_new(initTestCorpusPath, initTestCorpusPath + ".TAGGED")

    print 'Completed!'

def printInstructions():
    print '\nRDRPOSTagger instructions for the use of external initial tagger:'
    print '\nTo train RDRPOSTagger for POS tagging in the use of label-initialized corpus:'
    print '\npython iRDRPOSTagger.py train PATH-TO-DIRECTORY GOLDEN-CORPUS INITIALIZED-CORPUS MODEL-NAME'
    print '\nExample: python iRDRPOSTagger.py train ../Sample/En correctTrain initTrain postagging.rdr'
    print '\nTo tag an initialized corpus using the trained model:'
    print '\npython iRDRPOSTagger.py tag PATH-TO-TRAINED-MODEL PATH-TO-INITIALIZED-CORPUS'
    print '\nExample: python iRDRPOSTagger.py tag ../Sample/En/T3-2/postagging.rdr ../Sample/En/initTest'
    print '\nHaving a look at http://rdrpostagger.sourceforge.net to find more information!!!'

def runiRDRPOSTagger(args = sys.argv[1:]):
    if (len(args) == 0):
        printInstructions()
    elif args[0].lower().find("train") > -1:
        Training()
    elif args[0].lower().find("tag") > -1:
        TaggingInitializedCorpus()
    else:
        printInstructions()

if __name__ == "__main__":
    runiRDRPOSTagger()
    pass
